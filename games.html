<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Danh sách Game - Chợ Ứng Dụng Game</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img src="images/logo.jpg" alt="Logo" class="logo" />
        <div>
          <h1>Chợ Ứng Dụng Game</h1>
        </div>
      </div>
      <nav class="main-nav">
        <a href="index.html">Trang chủ</a>
        <a href="games.html">Danh sách Game</a>
        <a href="guide.html">Hướng dẫn Đăng tải</a>
        <a href="submit.html">Gửi Game</a>
      </nav>
    </div>
  </header>

  <main class="container section">
    <h2>Danh sách Game</h2>
    <p class="muted">Danh sách các game đã đăng tải. Bấm Xem chi tiết để mở video demo hoặc tải về.</p>

    <div class="controls">
      <input id="search" type="search" placeholder="Tìm theo tên hoặc thể loại..." />
    </div>

    <div id="game-list" class="grid">
      <!-- Lặp 5 game mẫu -->
      <article class="card" data-title="Happy Boo" data-genre="Arcade">
        <img src="https://via.placeholder.com/320x180.png?text=Catch+the+Clown" alt="Happy Boo" />
        <div class="card-body">
          <h3 class="game-title">Happy Boo</h3>
          <p class="meta">Tác giả: Nguyễn Huỳnh Khíp</p>
          <p class="desc">Thể loại bắn súng sinh tồn</p>
          <div class="card-actions">
            <a class="btn" href="#" target="_blank" rel="noopener">Tải về</a>
            <button class="btn outline" data-video="https://www.youtube.com/embed/dQw4w9WgXcQ" onclick="openDemo(this)">Xem demo</button>
          </div>
          <div class="card-footer">
            <div class="rating" data-score="5.0">
              ⭐️ <span class="score">5.0</span>
              <button class="rate-btn" onclick="openRating(this)">Đánh giá</button>
            </div>
            <button class="fav" onclick="toggleFav(this)">♡ Yêu thích</button>
          </div>
        </div>
      </article>

      <article class="card" data-title="Break Out" data-genre="Puzzle">
        <img src="https://via.placeholder.com/320x180.png?text=Fruit+Game" alt="Break Out" />
        <div class="card-body">
          <h3 class="game-title">Break Out</h3>
          <p class="meta">Tác giả: Đặng Minh Hùng</p>
          <p class="desc">Ghép trái cây để ghi điểm.</p>
          <div class="card-actions">
            <a class="btn" href="#" target="_blank" rel="noopener">Tải về</a>
            <button class="btn outline" data-video="https://www.youtube.com/embed/9bZkp7q19f0" onclick="openDemo(this)">Xem demo</button>
          </div>
          <div class="card-footer">
            <div class="rating" data-score="5.0">
              ⭐️ <span class="score">5.0</span>
              <button class="rate-btn" onclick="openRating(this)">Đánh giá</button>
            </div>
            <button class="fav" onclick="toggleFav(this)">♡ Yêu thích</button>
          </div>
        </div>
      </article>

      <article class="card" data-title="Jump Ball" data-genre="Adventure">
        <img src="https://via.placeholder.com/320x180.png?text=Maze+Runner" alt="Jump Ball" />
        <div class="card-body">
          <h3 class="game-title">Jump Ball</h3>
          <p class="meta">Tác giả: Trần Phước Anh Khoa</p>
          <p class="desc">Thể loại parkour</p>
          <div class="card-actions">
            <a class="btn" href="#" target="_blank" rel="noopener">Tải về</a>
            <button class="btn outline" data-video="https://www.youtube.com/embed/3JZ_D3ELwOQ" onclick="openDemo(this)">Xem demo</button>
          </div>
          <div class="card-footer">
            <div class="rating" data-score="5.0">
              ⭐️ <span class="score">5.0</span>
              <button class="rate-btn" onclick="openRating(this)">Đánh giá</button>
            </div>
            <button class="fav" onclick="toggleFav(this)">♡ Yêu thích</button>
          </div>
        </div>
      </article>

      <article class="card" data-title="RPG" data-genre="Shooter">
        <img src="https://via.placeholder.com/320x180.png?text=Space+Defender" alt="RPG" />
        <div class="card-body">
          <h3 class="game-title">RPG</h3>
          <p class="meta">Tác giả: Huỳnh Hoàng Huy</p>
          <p class="desc">Game nhập vai RPG vượt ải</p>
          <div class="card-actions">
            <a class="btn" href="#" target="_blank" rel="noopener">Tải về</a>
            <button class="btn outline" data-video="https://www.youtube.com/embed/V-_O7nl0Ii0" onclick="openDemo(this)">Xem demo</button>
          </div>
          <div class="card-footer">
            <div class="rating" data-score="5.0">
              ⭐️ <span class="score">5.0</span>
              <button class="rate-btn" onclick="openRating(this)">Đánh giá</button>
            </div>
            <button class="fav" onclick="toggleFav(this)">♡ Yêu thích</button>
          </div>
        </div>
      </article>

      <article class="card" data-title="Snake Remix" data-genre="Puzzle">
        <img src="https://via.placeholder.com/320x180.png?text=Puzzle+Island" alt="Snake Remix" />
        <div class="card-body">
          <h3 class="game-title">Snake Remix</h3>
          <p class="meta">Tác giả: Phạm Quốc Huy</p>
          <p class="desc">Di chuyển rắn để ăn táo từ đó tăng độ dài của rắn</p>
          <div class="card-actions">
            <a class="btn" href="#" target="_blank" rel="noopener">Tải về</a>
            <button class="btn outline" data-video="https://www.youtube.com/embed/2Vv-BfVoq4g" onclick="openDemo(this)">Xem demo</button>
          </div>
          <div class="card-footer">
            <div class="rating" data-score="5.0">
              ⭐️ <span class="score">5.0</span>
              <button class="rate-btn" onclick="openRating(this)">Đánh giá</button>
            </div>
            <button class="fav" onclick="toggleFav(this)">♡ Yêu thích</button>
          </div>
        </div>
      </article>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© <span id="year"></span> Chợ Ứng Dụng Game</p>
    </div>
  </footer>

  <!-- Modal demo video -->
  <div id="demo-modal" class="modal" aria-hidden="true" onclick="closeDemo(event)">
    <div class="modal-content" role="dialog" aria-modal="true" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeDemo(event)">✕</button>
      <div class="video-wrap">
        <iframe id="demo-iframe" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
    </div>
  </div>

  <!-- Modal đánh giá -->
  <div id="rating-modal" class="modal" aria-hidden="true" onclick="closeRating(event)">
    <div class="modal-content rating-modal-content" role="dialog" aria-modal="true" onclick="event.stopPropagation()">
      <button class="modal-close" onclick="closeRating(event)">✕</button>
      <div class="rating-form">
        <h3>Đánh giá game</h3>
        <p class="muted">Chọn số sao để đánh giá</p>
        <div class="star-rating">
          <span class="star" data-value="1" onclick="selectStar(1)">☆</span>
          <span class="star" data-value="2" onclick="selectStar(2)">☆</span>
          <span class="star" data-value="3" onclick="selectStar(3)">☆</span>
          <span class="star" data-value="4" onclick="selectStar(4)">☆</span>
          <span class="star" data-value="5" onclick="selectStar(5)">☆</span>
        </div>
        <button class="btn" onclick="submitRating()">Gửi đánh giá</button>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast-notification" class="toast-notification">
    <div class="toast-icon">⭐</div>
    <div class="toast-message"></div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const searchInput = document.getElementById('search');
    searchInput && searchInput.addEventListener('input', function () {
      const q = this.value.trim().toLowerCase();
      document.querySelectorAll('#game-list .card').forEach(card => {
        const title = card.dataset.title.toLowerCase();
        const genre = (card.dataset.genre || '').toLowerCase();
        card.style.display = (title.includes(q) || genre.includes(q)) ? '' : 'none';
      });
    });

    function toggleFav(btn) {
      btn.classList.toggle('fav-active');
      btn.textContent = btn.classList.contains('fav-active') ? '♥ Đã yêu thích' : '♡ Yêu thích';
    }

    function openDemo(el) {
      const url = el.getAttribute('data-video');
      const iframe = document.getElementById('demo-iframe');
      iframe.src = url + '?rel=0';
      const modal = document.getElementById('demo-modal');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
    }
    function closeDemo(e) {
      e && e.preventDefault && e.preventDefault();
      const iframe = document.getElementById('demo-iframe');
      iframe.src = '';
      const modal = document.getElementById('demo-modal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
    }

    let currentRatingCard = null;
    let selectedStarValue = 0;

    function openRating(btn) {
      currentRatingCard = btn.closest('.card');
      selectedStarValue = 0;
      document.querySelectorAll('.star').forEach(s => s.textContent = '☆');
      const modal = document.getElementById('rating-modal');
      modal.style.display = 'flex';
      modal.setAttribute('aria-hidden', 'false');
    }

    function closeRating(e) {
      e && e.preventDefault && e.preventDefault();
      const modal = document.getElementById('rating-modal');
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
      currentRatingCard = null;
      selectedStarValue = 0;
    }

    function selectStar(value) {
      selectedStarValue = value;
      const stars = document.querySelectorAll('.star');
      stars.forEach((star, index) => {
        star.textContent = index < value ? '★' : '☆';
      });
    }

    function submitRating() {
      if (selectedStarValue === 0) {
        showToast('Vui lòng chọn số sao đánh giá!', 'warning');
        return;
      }
      
      if (currentRatingCard) {
        const ratingDiv = currentRatingCard.querySelector('.rating');
        const currentScore = parseFloat(ratingDiv.dataset.score);
        const currentCount = parseInt(ratingDiv.dataset.count || '1');
        
        // Tính điểm trung bình mới
        const newScore = ((currentScore * currentCount) + selectedStarValue) / (currentCount + 1);
        ratingDiv.dataset.score = newScore.toFixed(1);
        ratingDiv.dataset.count = currentCount + 1;
        
        // Cập nhật hiển thị
        const scoreSpan = ratingDiv.querySelector('.score');
        scoreSpan.textContent = newScore.toFixed(1);
        
        showToast(`Cảm ơn bạn đã đánh giá ${selectedStarValue} sao! ⭐`, 'success');
        closeRating();
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast-notification');
      const messageEl = toast.querySelector('.toast-message');
      const iconEl = toast.querySelector('.toast-icon');
      
      messageEl.textContent = message;
      
      if (type === 'success') {
        iconEl.textContent = '✓';
        toast.className = 'toast-notification toast-success';
      } else if (type === 'warning') {
        iconEl.textContent = '⚠';
        toast.className = 'toast-notification toast-warning';
      }
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
  </script>
</body>
</html>
